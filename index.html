<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de M²</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <style>
       body {
    font-family: 'Roboto', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f7f8fc;
    color: #333;
}

.container {
    max-width: 800px;
    margin: 40px auto;
    background-color: #fff;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
}

.header {
    text-align: center;
    margin-bottom: 20px;
}

.header h1 {
    font-family: 'Montserrat', sans-serif;
    font-size: 28px;
    color: #4CAF50;
    margin: 0;
}

.medida-group {
    display: flex;
    flex-direction: column;
    margin-bottom: 15px;
    padding: 10px 0;
    border-bottom: 1px solid #ddd;
}

.medida-row {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
}

.medida-group input, .medida-group select {
    padding: 8px;
    margin-right: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 14px;
    flex: 1 1 60px;
    box-sizing: border-box;
    min-width: 60px;
}

.medida-group input[type="checkbox"], .medida-group .toggle-icon {
    width: 30px;
    flex-shrink: 0;
    text-align: center;
}

.medida-group input.invalid {
    border-color: #ff0000;
}

.medida-group input.disabled, .medida-group select.disabled {
    opacity: 0.5;
}

.medida-group .hidden {
    display: none;
}

.resultado {
    text-align: right;
    margin-top: 20px;
    font-size: 20px;
    font-weight: bold;
    color: #4CAF50;
}

.button-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 20px;
    flex-wrap: wrap;
}

.add-button, .clear-button {
    background: linear-gradient(45deg, #4CAF50, #388E3C);
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    margin: 10px;
    flex-grow: 1;
    text-align: center;
    transition: background 0.3s ease;
}

.add-button:hover {
    background: linear-gradient(45deg, #388E3C, #4CAF50);
}

.clear-button {
    background: linear-gradient(45deg, #FF5722, #E64A19);
}

.clear-button:hover {
    background: linear-gradient(45deg, #E64A19, #FF5722);
}

.toggle-icon {
    cursor: pointer;
    font-size: 18px;
    color: #4CAF50;
}

.additional-fields {
    display: flex;
    width: 100%;
    justify-content: space-between;
    flex-wrap: wrap;
    margin-top: 10px;
    transition: all 0.3s ease;
}

.additional-fields select {
    flex: 1 1 45%;
    margin-top: 5px;
}

@media (max-width: 600px) {
    .container {
        max-width: 100%;
        padding: 20px;
    }

    .button-container {
        flex-direction: column;
    }

    .add-button, .clear-button {
        width: 100%;
        margin: 10px 0;
    }

    .medida-group input, .medida-group select {
        width: 100%;
        margin-bottom: 10px;
    }

    .resultado {
        margin-bottom: 60px;
    }
}

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Calculadora de M²</h1>
        </div>
        <div id="medidasContainer"></div>
        <div class="resultado" id="resultado">Total M²: 0,00</div>
        <div class="button-container">
            <button class="add-button" onclick="addMedidaGroup()">Adicionar Medida</button>
            <button class="clear-button" onclick="confirmClearMedidas()">Novo Orçamento</button>
        </div>
    </div>

    <script>
        function addMedidaGroup(largura = '', altura = '', quantidade = 1, isChecked = true, ambiente = '', tipoAplicacao = '') {
            const container = document.getElementById('medidasContainer');
            const lastGroup = container.lastElementChild;

            if (lastGroup && !isGroupPopulated(lastGroup)) {
                alert('Preencha todos os campos do grupo de medidas atual antes de adicionar um novo.');
                return;
            }

            const medidaGroup = document.createElement('div');
            medidaGroup.classList.add('medida-group');

            medidaGroup.innerHTML = `
                <div class="medida-row">
                    <input type="checkbox" ${isChecked ? 'checked' : ''} onchange="toggleInputs(this)">
                    <input type="number" placeholder="Larg" value="${largura}" oninput="calculateTotal()">
                    <input type="number" placeholder="Alt" value="${altura}" oninput="calculateTotal()">
                    <input type="number" placeholder="Qtd" value="${quantidade}" oninput="calculateTotal()">
                    <input type="number" placeholder="Tm²" disabled>
                    <span class="toggle-icon" onclick="toggleAdditionalFields(this)">&#x25BC;</span>
                </div>
                <div class="additional-fields hidden">
                    <select onchange="calculateTotal()">
                        <option value="">Ambiente</option>
                        <option value="Sala de estar">Sala de estar</option>
                        <option value="Sala de jantar">Sala de jantar</option>
                        <option value="Cozinha">Cozinha</option>
                        <option value="Copa">Copa</option>
                        <option value="Suite 1">Suite 1</option>
                        <option value="Suite 2">Suite 2</option>
                        <option value="Quarto 1">Quarto 1</option>
                        <option value="Quarto 2">Quarto 2</option>
                        <option value="Quarto 3">Quarto 3</option>
                        <option value="Quarto 4">Quarto 4</option>
                        <option value="Quarto empregada">Quarto empregada</option>
                        <option value="Quarto principal">Quarto principal</option>
                        <option value="Quarto de hóspedes">Quarto de hóspedes</option>
                        <option value="Banheiro 1">Banheiro 1</option>
                        <option value="Banheiro 2">Banheiro 2</option>
                        <option value="Banheiro 3">Banheiro 3</option>
                        <option value="Banheiro de hóspedes">Banheiro de hóspedes</option>
                        <option value="Corredor">Corredor</option>
                        <option value="Escada">Escada</option>
                        <option value="Escritório">Escritório</option>
                        <option value="Lavanderia">Lavanderia</option>
                        <option value="Garagem">Garagem</option>
                        <option value="Varanda">Varanda</option>
                        <option value="Jardim">Jardim</option>
                        <option value="Sotão">Sotão</option>
                        <option value="Porão">Porão</option>
                        <option value="Outros">Outros</option>
                    </select>
                    <select onchange="calculateTotal()">
                        <option value="">Tipo de Aplicação</option>
                        <option value="Janela Padrão">Janela Padrão</option>
                        <option value="Janelão">Janelão</option>
                        <option value="Porta">Porta</option>
                        <option value="Porta Balcão">Porta Balcão</option>
                        <option value="Vitrine">Vitrine</option>
                        <option value="Tampo de mesa">Tampo de mesa</option>
                        <option value="Box de banheiro">Box de banheiro</option>
                        <option value="Guarda-corpo">Guarda-corpo</option>
                        <option value="Dispensa">Dispensa</option>
                        <option value="Armário">Armário</option>
                        <option value="Teto">Teto</option>
                        <option value="Parede divisória">Parede divisória</option>
                        <option value="Fachada">Fachada</option>
                        <option value="Claraboia">Claraboia</option>
                        <option value="Balcão">Balcão</option>
                        <option value="Outras">Outras</option>
                    </select>
                </div>
            `;

            container.appendChild(medidaGroup);

            // Definir os valores das seleções
            const selects = medidaGroup.querySelectorAll('select');
            if (selects.length > 0) {
                selects[0].value = ambiente;
                selects[1].value = tipoAplicacao;
            }

            // Dar foco no último grupo de medidas adicionado
            const inputs = medidaGroup.querySelectorAll('input[type="number"]');
            if (inputs.length > 0) {
                inputs[0].focus();
                medidaGroup.scrollIntoView({ behavior: 'smooth' });
            }

            calculateTotal();
        }

        function isGroupPopulated(group) {
            const inputs = group.querySelectorAll('input[type="number"]');
            return Array.from(inputs).every(input => input.value.trim() !== '');
        }

        function toggleInputs(checkbox) {
            const inputs = checkbox.parentElement.querySelectorAll('input[type="number"], select');
            inputs.forEach(input => {
                if (checkbox.checked) {
                    input.disabled = false;
                    input.classList.remove('disabled');
                } else {
                    input.disabled = true;
                    input.classList.add('disabled');
                }
            });
            calculateTotal();
        }

        function toggleAdditionalFields(icon) {
            const additionalFields = icon.parentElement.nextElementSibling;
            additionalFields.classList.toggle('hidden');
            icon.innerHTML = additionalFields.classList.contains('hidden') ? '&#x25BC;' : '&#x25B2;';
        }

        function calculateTotal() {
            const medidaGroups = document.querySelectorAll('.medida-group');
            let totalM2 = 0;

            medidaGroups.forEach(group => {
                const isChecked = group.querySelector('input[type="checkbox"]').checked;
                const largura = parseFloat(group.querySelector('input[placeholder="Larg"]').value);
                const altura = parseFloat(group.querySelector('input[placeholder="Alt"]').value);
                const quantidade = parseInt(group.querySelector('input[placeholder="Qtd"]').value);

                if (isChecked && !isNaN(largura) && !isNaN(altura) && !isNaN(quantidade)) {
                    const total = largura * altura * quantidade;
                    totalM2 += total;
                    group.querySelector('input[placeholder="Tm²"]').value = total.toFixed(2);
                    group.querySelector('input[placeholder="Larg"]').classList.remove('invalid');
                    group.querySelector('input[placeholder="Alt"]').classList.remove('invalid');
                    group.querySelector('input[placeholder="Qtd"]').classList.remove('invalid');
                } else {
                    group.querySelector('input[placeholder="Tm²"]').value = 0;
                    if (isNaN(largura)) group.querySelector('input[placeholder="Larg"]').classList.add('invalid');
                    else group.querySelector('input[placeholder="Larg"]').classList.remove('invalid');

                    if (isNaN(altura)) group.querySelector('input[placeholder="Alt"]').classList.add('invalid');
                    else group.querySelector('input[placeholder="Alt"]').classList.remove('invalid');

                    if (isNaN(quantidade)) group.querySelector('input[placeholder="Qtd"]').classList.add('invalid');
                    else group.querySelector('input[placeholder="Qtd"]').classList.remove('invalid');
                }
            });

            document.getElementById('resultado').innerText = `Total M²: ${totalM2.toFixed(2)}`;
            saveMedidas();
        }

        function saveMedidas() {
            try {
                const medidaGroups = document.querySelectorAll('.medida-group');
                const medidas = Array.from(medidaGroups).map(group => {
                    const isChecked = group.querySelector('input[type="checkbox"]').checked;
                    const largura = group.querySelector('input[placeholder="Larg"]').value;
                    const altura = group.querySelector('input[placeholder="Alt"]').value;
                    const quantidade = group.querySelector('input[placeholder="Qtd"]').value;
                    const ambiente = group.querySelector('.additional-fields select:nth-child(1)').value;
                    const tipoAplicacao = group.querySelector('.additional-fields select:nth-child(2)').value;
                    return { isChecked, largura, altura, quantidade, ambiente, tipoAplicacao };
                });
                localStorage.setItem('medidas', JSON.stringify(medidas));
                console.log('Medidas salvas com sucesso.');
            } catch (e) {
                console.error('Erro ao salvar medidas:', e);
            }
        }

        function loadMedidas() {
            try {
                const savedMedidas = localStorage.getItem('medidas');
                if (savedMedidas) {
                    const medidas = JSON.parse(savedMedidas);
                    medidas.forEach(medida => {
                        addMedidaGroup(medida.largura, medida.altura, medida.quantidade, medida.isChecked, medida.ambiente, medida.tipoAplicacao);
                    });
                } else {
                    addMedidaGroup();
                }
                console.log('Medidas carregadas com sucesso.');
            } catch (e) {
                console.error('Erro ao carregar medidas:', e);
                addMedidaGroup();
            }
        }

        function clearMedidas() {
            try {
                localStorage.removeItem('medidas');
                document.getElementById('medidasContainer').innerHTML = '';
                addMedidaGroup();
                calculateTotal();
                console.log('Medidas limpas com sucesso.');
            } catch (e) {
                console.error('Erro ao limpar medidas:', e);
            }
        }

        function confirmClearMedidas() {
            if (confirm("Tem certeza que deseja iniciar um novo orçamento? Isso apagará todas as medidas atuais.")) {
                clearMedidas();
            }
        }

        // Carrega as medidas salvas ao carregar a página
        window.onload = loadMedidas;
    </script>
</body>
</html>
